# 前后端接口规范文档

## 1. 接口设计原则

### 1.1 RESTful API设计
- 使用HTTP动词表示操作：GET（查询）、POST（创建）、PUT（更新）、DELETE（删除）
- 使用名词表示资源，避免使用动词
- 使用复数形式表示资源集合，如/users、/plans
- 使用嵌套资源表示资源间关系，如/users/{userId}/plans

### 1.2 统一响应格式
所有API响应都采用统一的JSON格式，包含以下字段：
```json
{
  "code": 200,          // 状态码
  "message": "操作成功",  // 响应消息
  "data": {},           // 响应数据
  "timestamp": "2023-11-15T10:30:00Z"  // 响应时间戳
}
```

### 1.3 错误处理规范
错误响应也采用统一格式：
```json
{
  "code": 400,          // 错误码
  "message": "请求参数错误",  // 错误消息
  "error": "详细错误信息",    // 详细错误描述
  "timestamp": "2023-11-15T10:30:00Z"  // 响应时间戳
}
```

## 2. 接口命名规范

### 2.1 URL命名规范
- 使用小写字母和连字符，如/user-management
- 避免使用下划线和大写字母
- URL层级不宜过深，建议不超过3层
- 使用版本控制，如/api/v1/users

### 2.2 资源命名规范
- 使用名词复数形式表示资源集合
- 使用单数形式表示单个资源
- 使用有意义的名称，避免缩写和简写
- 保持命名一致性

### 2.3 查询参数规范
- 使用小写字母和下划线，如page_size
- 布尔值参数使用is/has前缀，如is_active
- 日期范围参数使用start_和end_前缀，如start_date
- 排序参数使用sort和order，如sort=create_time&order=desc

## 3. 请求响应规范

### 3.1 请求头规范
所有请求需要包含以下标准头：
```
Content-Type: application/json
Authorization: Bearer {token}
X-Requested-With: XMLHttpRequest
```

### 3.2 请求体规范
- 请求体使用JSON格式
- 使用驼峰命名法（前端）
- 日期格式使用ISO 8601标准
- 空值使用null而不是空字符串

### 3.3 响应体规范
- 响应体使用JSON格式
- 使用下划线命名法（后端）
- 日期格式使用ISO 8601标准
- 空值使用null而不是空字符串

## 4. 数据传输规范

### 4.1 分页规范
分页请求参数：
```json
{
  "page": 1,        // 页码，从1开始
  "size": 20,       // 每页大小，默认20
  "sort": "createTime",  // 排序字段
  "order": "desc"   // 排序方向：asc/desc
}
```

分页响应数据：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "content": [],    // 数据列表
    "totalElements": 100,  // 总记录数
    "totalPages": 5,  // 总页数
    "size": 20,       // 每页大小
    "number": 0,      // 当前页码（从0开始）
    "first": true,    // 是否第一页
    "last": false     // 是否最后一页
  },
  "timestamp": "2023-11-15T10:30:00Z"
}
```

### 4.2 日期时间规范
- 使用ISO 8601格式：YYYY-MM-DDTHH:mm:ssZ
- 时区统一使用UTC
- 日期范围参数使用start_date和end_date
- 日期格式化参数使用format指定

### 4.3 文件上传规范
文件上传使用multipart/form-data格式：
```
Content-Type: multipart/form-data; boundary=boundary
```

文件上传响应：
```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "fileId": "uuid",
    "fileName": "example.jpg",
    "fileSize": 1024,
    "fileType": "image/jpeg",
    "uploadTime": "2023-11-15T10:30:00Z",
    "fileUrl": "https://example.com/files/uuid"
  },
  "timestamp": "2023-11-15T10:30:00Z"
}
```

## 5. 认证授权规范

### 5.1 JWT认证
- 使用JWT进行身份认证
- Token在请求头中传递：Authorization: Bearer {token}
- Token有效期为24小时
- Token包含用户ID、角色、权限等信息

### 5.2 权限控制
- 基于角色的访问控制（RBAC）
- 权限格式：resource:action，如user:create
- 支持角色继承和权限组合
- 接口级权限控制

### 5.3 API限流
- 使用令牌桶算法进行API限流
- 不同接口设置不同的限流阈值
- 超出限流返回429状态码
- 限流信息在响应头中返回

## 6. 状态码规范

### 6.1 成功状态码
- 200 OK：请求成功
- 201 Created：资源创建成功
- 204 No Content：请求成功但无返回内容

### 6.2 客户端错误状态码
- 400 Bad Request：请求参数错误
- 401 Unauthorized：未认证
- 403 Forbidden：无权限
- 404 Not Found：资源不存在
- 409 Conflict：资源冲突
- 422 Unprocessable Entity：请求格式正确但语义错误
- 429 Too Many Requests：请求过于频繁

### 6.3 服务器错误状态码
- 500 Internal Server Error：服务器内部错误
- 502 Bad Gateway：网关错误
- 503 Service Unavailable：服务不可用
- 504 Gateway Timeout：网关超时

## 7. 业务接口规范

### 7.1 套餐管理接口

#### 7.1.1 查询套餐列表
```
GET /api/v1/plans
```

请求参数：
```json
{
  "page": 1,
  "size": 20,
  "name": "套餐名称",
  "minPrice": 100,
  "maxPrice": 200,
  "status": "ACTIVE"
}
```

响应数据：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "content": [
      {
        "planId": "uuid",
        "name": "畅享套餐",
        "price": 109.00,
        "dataFlow": 40,
        "simCardCount": 2,
        "broadband": 500,
        "callDuration": 1000,
        "discount": 0.7,
        "status": "ACTIVE",
        "createTime": "2023-11-15T10:30:00Z",
        "updateTime": "2023-11-15T10:30:00Z"
      }
    ],
    "totalElements": 100,
    "totalPages": 5,
    "size": 20,
    "number": 0,
    "first": true,
    "last": false
  },
  "timestamp": "2023-11-15T10:30:00Z"
}
```

#### 7.1.2 创建套餐
```
POST /api/v1/plans
```

请求参数：
```json
{
  "name": "畅享套餐",
  "price": 109.00,
  "dataFlow": 40,
  "simCardCount": 2,
  "broadband": 500,
  "callDuration": 1000,
  "discount": 0.7
}
```

响应数据：
```json
{
  "code": 201,
  "message": "创建成功",
  "data": {
    "planId": "uuid",
    "name": "畅享套餐",
    "price": 109.00,
    "dataFlow": 40,
    "simCardCount": 2,
    "broadband": 500,
    "callDuration": 1000,
    "discount": 0.7,
    "status": "ACTIVE",
    "createTime": "2023-11-15T10:30:00Z",
    "updateTime": "2023-11-15T10:30:00Z"
  },
  "timestamp": "2023-11-15T10:30:00Z"
}
```

#### 7.1.3 更新套餐
```
PUT /api/v1/plans/{planId}
```

请求参数：
```json
{
  "name": "畅享套餐",
  "price": 119.00,
  "dataFlow": 50,
  "simCardCount": 2,
  "broadband": 500,
  "callDuration": 1000,
  "discount": 0.7
}
```

响应数据：
```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "planId": "uuid",
    "name": "畅享套餐",
    "price": 119.00,
    "dataFlow": 50,
    "simCardCount": 2,
    "broadband": 500,
    "callDuration": 1000,
    "discount": 0.7,
    "status": "ACTIVE",
    "createTime": "2023-11-15T10:30:00Z",
    "updateTime": "2023-11-15T10:30:00Z"
  },
  "timestamp": "2023-11-15T10:30:00Z"
}
```

#### 7.1.4 删除套餐
```
DELETE /api/v1/plans/{planId}
```

响应数据：
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null,
  "timestamp": "2023-11-15T10:30:00Z"
}
```

### 7.2 用户管理接口

#### 7.2.1 查询用户列表
```
GET /api/v1/users
```

请求参数：
```json
{
  "page": 1,
  "size": 20,
  "username": "用户名",
  "mobile": "手机号",
  "status": "ACTIVE",
  "startDate": "2023-11-01",
  "endDate": "2023-11-30"
}
```

响应数据：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "content": [
      {
        "userId": "uuid",
        "username": "user001",
        "mobile": "13800138000",
        "email": "user@example.com",
        "realName": "张三",
        "status": "ACTIVE",
        "planId": "uuid",
        "planName": "畅享套餐",
        "registerTime": "2023-11-15T10:30:00Z",
        "lastLoginTime": "2023-11-15T10:30:00Z"
      }
    ],
    "totalElements": 100,
    "totalPages": 5,
    "size": 20,
    "number": 0,
    "first": true,
    "last": false
  },
  "timestamp": "2023-11-15T10:30:00Z"
}
```

#### 7.2.2 创建用户
```
POST /api/v1/users
```

请求参数：
```json
{
  "username": "user001",
  "password": "password123",
  "mobile": "13800138000",
  "email": "user@example.com",
  "realName": "张三",
  "planId": "uuid"
}
```

响应数据：
```json
{
  "code": 201,
  "message": "创建成功",
  "data": {
    "userId": "uuid",
    "username": "user001",
    "mobile": "13800138000",
    "email": "user@example.com",
    "realName": "张三",
    "status": "ACTIVE",
    "planId": "uuid",
    "planName": "畅享套餐",
    "registerTime": "2023-11-15T10:30:00Z",
    "lastLoginTime": "2023-11-15T10:30:00Z"
  },
  "timestamp": "2023-11-15T10:30:00Z"
}
```

### 7.3 财报分析接口

#### 7.3.1 收入分析
```
GET /api/v1/reports/revenue
```

请求参数：
```json
{
  "startDate": "2023-11-01",
  "endDate": "2023-11-30",
  "groupBy": "day",  // day, week, month
  "planIds": ["uuid1", "uuid2"]
}
```

响应数据：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "summary": {
      "totalRevenue": 1000000.00,
      "growthRate": 0.15,
      "planRevenue": [
        {
          "planId": "uuid",
          "planName": "畅享套餐",
          "revenue": 500000.00,
          "percentage": 0.5
        }
      ]
    },
    "details": [
      {
        "date": "2023-11-01",
        "revenue": 30000.00,
        "planRevenue": [
          {
            "planId": "uuid",
            "planName": "畅享套餐",
            "revenue": 15000.00
          }
        ]
      }
    ]
  },
  "timestamp": "2023-11-15T10:30:00Z"
}
```

#### 7.3.2 用户分析
```
GET /api/v1/reports/users
```

请求参数：
```json
{
  "startDate": "2023-11-01",
  "endDate": "2023-11-30",
  "groupBy": "day",  // day, week, month
  "region": "全省"
}
```

响应数据：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "summary": {
      "totalUsers": 100000,
      "newUsers": 5000,
      "activeUsers": 80000,
      "churnRate": 0.02
    },
    "details": [
      {
        "date": "2023-11-01",
        "newUsers": 150,
        "activeUsers": 2500,
        "churnUsers": 50
      }
    ],
    "regionDistribution": [
      {
        "region": "广州",
        "userCount": 30000,
        "percentage": 0.3
      }
    ]
  },
  "timestamp": "2023-11-15T10:30:00Z"
}
```

## 8. 接口文档规范

### 8.1 文档结构
每个接口文档包含以下部分：
- 接口名称
- 接口描述
- 请求URL
- 请求方法
- 请求参数
- 请求示例
- 响应参数
- 响应示例
- 错误码说明

### 8.2 文档维护
- 使用Swagger/OpenAPI自动生成接口文档
- 接口变更时及时更新文档
- 定期审查接口文档的准确性和完整性
- 提供在线接口测试功能

### 8.3 版本管理
- 接口版本通过URL路径管理，如/api/v1/、/api/v2/
- 新版本接口保持向后兼容
- 废弃接口提前通知并设置过渡期
- 维护接口版本变更日志

---

文档版本：V1.0  
创建日期：2023年11月15日  
最后更新：2023年11月15日  
创建人：架构师  
审核人：技术总监